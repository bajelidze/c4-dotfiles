#!/bin/bash

set -e

_update() {
  local ccc="$1"

  if [[ -z "$ccc" ]]; then
    echo "Specify the c4 working copy to update to" >&2
    return 1
  fi

  echo "Updating..."

  sudo systemctl stop c4
  sudo systemctl stop c4_cloud_command

  c4 fetch -r "$ccc"
  sudo cp "$HOME/.ccc$(c4 info "$ccc" Local-Linkdir)/bin/c4" "$(which c4)"

  sudo systemctl start c4
  sudo systemctl start c4_cloud_command --no-block

  echo "Updated to $ccc" >&2
}

_update "$@"
